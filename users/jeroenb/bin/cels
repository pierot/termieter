#!/bin/bash
# Generated by ChatGPT

# Define color codes
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
RESET='\033[0m'

# Define emoji for success or failure
SUCCESS_EMOJI="✅"
ERROR_EMOJI="❌"

# Check if .tool-versions file exists
if [[ ! -f ".tool-versions" ]]; then
  echo -e "${RED}${ERROR_EMOJI} Error: .tool-versions file not found in the current directory.${RESET}"
  exit 1
fi

# Extract the Elixir and Erlang versions from the .tool-versions file
elixir_version=$(grep -oP '^elixir \K[\d\.]+' .tool-versions)
erlang_version=$(grep -oP '^erlang \K[\d\.]+' .tool-versions)

# Check if Elixir and Erlang versions are found in the .tool-versions file
if [[ -z "$elixir_version" ]]; then
  echo -e "${RED}${ERROR_EMOJI} Error: Elixir version not found in .tool-versions file.${RESET}"
  exit 1
fi

if [[ -z "$erlang_version" ]]; then
  echo -e "${RED}${ERROR_EMOJI} Error: Erlang version not found in .tool-versions file.${RESET}"
  exit 1
fi

# Extract the first part of the Erlang version (before the first dot)
erlang_major_version=$(echo "$erlang_version" | cut -d'.' -f1)

# Define the path to the folder where the version is located
install_folder="$HOME/.cache/nvim/elixir-tools.nvim/installs/elixir-lsp/elixir-ls/tags_v0.22.0/$elixir_version-$erlang_major_version"

# Check if the specific folder exists and delete it
if [[ -d "$install_folder" ]]; then
  echo -e "${YELLOW}Deleting folder: ${BLUE}$install_folder${RESET}"
  rm -rf "$install_folder"
  echo -e "${GREEN}${SUCCESS_EMOJI} Deleted the Elixir LSP folder for Elixir version $elixir_version and Erlang version $erlang_version.${RESET}"
else
  echo -e "${RED}${ERROR_EMOJI} No folder found for Elixir version $elixir_version and Erlang version $erlang_version at $install_folder.${RESET}"
fi
